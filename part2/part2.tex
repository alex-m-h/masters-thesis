\documentclass[../master_thesis.tex]{subfiles}
\begin{document}
\section{Variational formulation of the magnetostatic in 2D}

In 2D we have the Hilbert complex 
\begin{align*}
    ?????????
\end{align*}
where we have the $\curl$ which is the scalar curl and 
$\mathbf{\curl}$ which is the vector valued curl defined as.

It is easily derived that we have the integration by parts formula if $\mathbf{v} \in C_b^1(\overline{\Omega})$.
Here $\Omega$ is from now on assumed bounded and Lipschitz.

The 2D magnetostatic problem is then
Let $J \in B^*_0$ be given. Then
\begin{problem}[2D magnetostatic problem]
    Find $\mathbf{B} \in H_0(\diver) \cap H(\curl)$ s.t.
    \begin{align*}
        \curl \mathbf{B} &= J,
        \\ \diver \mathbf{B} = 0,
        \text{+ additional constraints}
    \end{align*}
\end{problem}
The additional constraints are necessary to give a unique solution. 
We will focus, just as in the first part, on 
a curve integral as additional constraint. 
Another option would be an orthogonality constraint as in \ref{}.

\subsection{Mixed formulation}
In order to solve this problem numerically using finite elements we have to 
choose a suitable variational formulation of the problem. We will use the following
For any $J \in \curl H(\curl)$ find $\sigma \in H^1_0$, 
$B \in H_0(\diver)$ and $p \in \mathfrak{H}^1$ s.t.
\begin{align}
    \langle \sigma, \tau \rangle - \langle u, \mathbf{\curl}\tau \rangle 
        &=  -\langle J, \tau \rangle \quad \forall \tau \in H^1_0, \label{eq:first_eq_mixed_formulation}
    \\ \langle \mathbf{\curl}\sigma, \mathbf{v} \rangle + \langle \diver \mathbf{B}, \diver \mathbf{v} \rangle 
        + \langle \mathbf{p}, \mathbf{v} \rangle 
        &= 0 \quad \forall \mathbf{v} \in V^k \text{ and} \label{eq:second_eq_mixed_formulation}
        \text{+ additional constraints}
\end{align} 
This formulation is of course much more complicated than the first one \ref{}, 
but this formulation will turns out to be well-suited for finite element approximations.
But it begs the question if the two formulations are equivalent. We will answer it 
in two propositions. We will treat the harmonic constraint separately.

\begin{proposition}
    For any $J \in L^2$, (\ref{eq:first_eq_mixed_formulation}) and 
    (\ref{eq:second_eq_mixed_formulation}) hold i.i.f. 
    $\sigma = 0$, $\mathbf{p}=0$ and $\curl \mathbf{B} = J$ and 
    $\diver \mathbf{B} = 0$
    i.e. the magnetostatic \ref{}  is fulfilled without the additional 
    constraint.
\end{proposition}
\begin{proof}
    Assume $(\sigma,\mathbf{B},\mathbf{p})$ is a solution of (\ref{eq:first_eq_mixed_formulation}) and 
    (\ref{eq:second_eq_mixed_formulation}). Then the first equation is
    \begin{align*}
        \langle \sigma + J, \tau \rangle  
        &=  \langle \mathbf{B}, \mathbf{\curl}\tau \rangle  \quad \forall \tau \in H^1_0
    \end{align*}
    which is equivalent to $\mathbf{B} \in H(\curl)$ and $J + \sigma = \curl \mathbf{B}$.

    Now assume additionally, that  
    (\ref{eq:second_eq_mixed_formulation}) holds. Then by choosing $\mathbf{v} \mathfrak{p} \in \mathfrak{H}^1$
    we get from the definition of the harmonic forms 
    and $\mathfrak{H}^1 \perp \mathbf{\curl} H^1_0$ from the Hodge decomposition and thus
    \begin{align*}
        \langle \mathbf{\curl} \sigma, \mathfrak{p} \rangle + \langle du, d\mathfrak{p} \rangle + \langle p, \mathfrak{p} \rangle
        = \langle p, \mathfrak{p} \rangle = 0
    \end{align*}
    and so $\mathfrak{p} = 0$. Then we can choose $\mathbf{v} = \mathbf{\curl} \sigma$ to get 
    \begin{align*}
        \langle \mathbf{\curl} \sigma, \mathbf{\curl} \sigma \rangle + \langle \diver \mathbf{B}, \diver \mathbf{\curl} \sigma \rangle 
            + \langle \mathbf{p}, \mathbf{\curl} \sigma \rangle
        = \lVert \mathbf{\curl} \sigma \rVert^2.
    \end{align*}
    Because $\sigma \in H^1_0$ this gives us $\sigma = 0$. Also we have then 
    $J = \curl \mathbf{B}$. At last we choose $\mathbf{v} = \mathbf{B}$ which gives us 
    $\diver \mathbf{B} = 0$ and thus we proved the first direction. 

    The other implication is clear i.e. if $\mathbf{B} \in H(\curl) \cap H_0(\diver)$
    with $\curl \mathbf{B} = J$ and $\diver \mathbf{B} = 0$ then the variational 
    formulation clearly holds.
    \end{proof}
If we now add the same additional constraints to both formulations of the problem 
then they will remain equivalent.


\subsection{Curve integral constraint}

We want to add now a curve integral constraint. We first want to rewrite the curve 
integral in variational form. 

Let $\Gamma$ be a closed curve with parametrization $\gamma:[0,|\Gamma|]$ s.t. 
$|\gamma'(t)| = 1$ and assume that $\gamma$ is bijective i.e. the curve does not 
intersect itself. Since $\Gamma$ is a closed curve 
it encompasses a set $K$ {\color{red} Add drawing} Let $\mathbf{n}$ be the 
unit normal of $K$. Then we know that $\mathbf{n} \perp \gamma'$. 

If we now take $\mathbf{B}$ that 
\begin{align*}
    n \times \mathbf{B} =   -\mathbf{B}\times n = -\mathbf{B} \cdot R_{\pi/2} \mathbf{n}
\end{align*}
then $R_{\pi/2} \mathbf{n}$ is either $\gamma'$ or $-\gamma'$. Assume w.l.o.g.
that $R_{\pi/2} \mathbf{n} = \gamma'$ and thus 
\begin{align*}
    -\mathbf{B} \cdot R_{\pi/2} \mathbf{n} = - \mathbf{B} \cdot \gamma'.
\end{align*}

So we see that we can write 
\begin{align*}
    n \times \mathbf{B} = - \mathbf{B} \cdot \gamma'
\end{align*}
and so the curve integral becomes

\begin{align*}
    \int_\Gamma \mathbf{B}\cdot dl= \int_0^{|\Gamma|} \mathbf{B}(\gamma(t)) \cdot \gamma'(t) \, dt 
    = - \int_0^{|\Gamma|} n(\gamma(t)) \times \mathbf{B}(\gamma(t)) \, dt 
    = - \int_\Gamma n \times \mathbf{B}.
\end{align*}

Defie $\psi$ s.t. $\psi = 0$ on $\partial \Omega_{in}$ and $\psi = 1$ on $\Gamma$ 
and constant one outside
Then we observe 

\begin{align*}
    \int_\Omega \mathbf{\curl} \psi \cdot \mathbf{B} \, dx = 
    \int_\Omega \psi \, J \, dx - \int_\partial\Omega n\times \mathbf{B} \, dl
    = \int_\Omega \psi \, J \, dx - \int_\Gamma \mathbf{B}\cdot dl
\end{align*}

Note that even though right hand side requires some regularity for $\mathbf{B}$
the left hand side makes sense even if $\mathbf{B}$ is only in $L^2$!
So if we are in a situation where the we have curve integral given then 
we can add this constraint like this. 

Let us assume we are given that the curve integral 
\begin{align*}
    \int_\Gamma \mathbf{B} \cdot dl = C_0
\end{align*}
assuming this makes sense. Then we choose $\psi$ and then get 
the constraint
\begin{align*}
    \langle \mathbf{\curl} \psi, \mathbf{B} \rangle = \langle J, \psi \rangle +-? C_0.
\end{align*}
Note that there are not test functions involved since $\psi$ is fixed. 
We define $C_1 \vcentcolon=  \langle J, \psi \rangle +-? C_0$. Then to get a variational 
formulation we multiply \ref{} with an arbitrary $\mu \in \real$. Then we reformulate 
the mixed variational form slightly. 

Let $J \in L^2$, $\mathbf{p} \in \mathfrak{H}^1$. 
Find $\sigma \in H^1_0$, $\mathbf{B} \in H_0(\diver)$, $\lambda \in \real$ s.t.
\begin{align}
    \langle \sigma, \tau \rangle - \langle u, \mathbf{\curl}\tau \rangle 
    &=  -\langle J, \tau \rangle \quad \forall \tau \in H^1_0, \label{eq:first_eq_mixed_formulation_curve_integral}
    \\ \langle \mathbf{\curl}\sigma, \mathbf{v} \rangle + \langle \diver \mathbf{B}, \diver \mathbf{v} \rangle 
    + \langle \lambda \mathbf{p}, \mathbf{v} \rangle 
    &= 0 \quad \forall \mathbf{v} \in V^k, \label{eq:second_eq_mixed_formulation_curve_integral}
    \\ \mu \langle \bm{\curl} \psi, \mathbf{B} \rangle &= \mu C_1 \quad \forall \mu \in \real.
\end{align}
which gives us the variational formulation of the magnetostatic problem with curve integral 
constraint. We will study the well-posedness of this formulation next. 
Using the analogous reasoning as in \ref{} we see that the first two equations are still equivalent 
to the magnetostatic problem without additional constraint even though we use now {\color{red} Need 
assumption that $\dim \mathfrak{H}^1= 1$}. 

Defining $X \vcentcolon= H^1_0 \times H_0(\diver) \times \real$ and the 
bilinear form $a:X\times X \rightarrow \real$

\begin{align*}
    a(\sigma,\mathbf{B}, \lambda;\tau,\mathbf{v},\mu) 
    =   \langle \sigma, \tau \rangle - \langle u, \mathbf{\curl}\tau \rangle
        + \langle \mathbf{\curl}\sigma, \mathbf{v} \rangle + \langle \diver \mathbf{B}, \diver \mathbf{v} \rangle 
        + \langle \lambda \mathbf{p}, \mathbf{v} \rangle - \mu \langle \mathbf{\curl} \psi, \mathbf{B} \rangle.
\end{align*}
This allows us to rewrite \ref{} in the standard form
\begin{align*}
    a(\sigma,\mathbf{B},\lambda;\tau,\mathbf{v},\mu) = -\langle J, \tau \rangle - \mu C_1
        \quad \forall (\tau,\mathbf{v},\mu) \in X.
\end{align*}
Note that the bilinear form $a$ is not symmetric. 

\begin{lemma}
    Define $T:X \rightarrow X$ as 
    \begin{align*}
        T(\sigma, \mathbf{B},\lambda)
        = (\sigma - \frac{1}{c_P^2}\rho, \veccurl \sigma + \mathbf{B} + \beta \mathbf{p},
            -\alpha \langle \mathbf{p}, \alpha \langle \mathfrak{p}, \mathbf{B} \rangle  
            + \frac{\lambda}{c_\psi} \rangle).
    \end{align*}
    Assume $c_\psi$ is positive.
    Then $T$ is surjective. 
\end{lemma}
\begin{proof}
    Take $(\tau, \mathbf{v},\mu) \in X$ arbitrary. Then 
    Now we choose $\sigma = (1+1/c_P)^{-1} (\tau + (1/c_P^2) \veccurl^{-1} \mathbf{v})$ 
    and $\mathbf{B}_\mathfrak{B} = \mathbf{v}_\mathfrak{B} - \veccurl \sigma$. 
    So 
    \begin{align*}
        \sigma -  1/c_P^2 \veccurl^{-1}\mathbf{B}_\mathfrak{B} 
        = \sigma -  1/c_P^2 (\veccurl^{-1} \mathbf{v} - \sigma)
        = (1+1/c_P^2)\sigma - 1/c_P^2 \veccurl^{-1} \mathbf{v}
        = \tau.
    \end{align*}
    We simply choose $\mathbf{B}_\mathfrak{B^*} = \mathbf{v}_\mathfrak{B^*}$.
    For the harmonic part we observe for $\mathbf{v}_\mathfrak{H} = c_v p$
    Let us look at the system 
    \begin{align*}
        \begin{pmatrix}
            1 & \beta 
            \\ \alpha & 1/c_\psi
        \end{pmatrix}
        \begin{pmatrix}
            \kappa_u 
            \\ \lambda 
        \end{pmatrix}
        = 
        \begin{pmatrix}
            c_v 
            \\ \mu
        \end{pmatrix}
    \end{align*}
    Now since $c_\psi > 0$ and $\alpha < 0$, $\beta > 0$ we get 
    $1/c_\psi - \alpha \beta \neq 0$ and the system has a solution. 
    Then we see 
    \begin{align*}
        \mathbf{v}_\mathfrak{H} = c_v p = p(\kappa_u + \beta \lambda) 
        =  \mathbf{B}_\mathfrak{H} + \beta \lambda p
    \end{align*}
    and 
    \begin{align*}
        \mu = \alpha \kappa_u + 1/c_\psi \lambda
        = \alpha \kappa_u \lVert p \rVert^2 + 1/c_\psi \lambda 
        = \alpha \langle \mathbf{B}, \mathbf{p} \rangle + 1/c_\psi \lambda.
    \end{align*}
    And so in comining all that we arrive at 
    $T(\sigma,\mathbf{B}, \mathbf{p}) = (\tau, \mathbf{v}, \mathbf{p})$.
\end{proof}

\begin{theorem}
    $a$ satisfies a inf-sup condition with $\gamma$ depending on the Poincaré constant 
    as well as $\psi$.
\end{theorem}
\begin{proof}
    We will use T-coercivity to prove it. 
    \begin{align*}
        T(\sigma, \mathbf{B},\lambda)
        = (\sigma - \frac{1}{c_P^2}\rho, \veccurl \sigma + \mathbf{B} + \beta \mathbf{p},
            -\alpha \langle \mathbf{p}, \alpha \langle \mathfrak{p}, \mathbf{B} \rangle  + \frac{\lambda}{c_\psi} \rangle)
    \end{align*}
    with $\beta = \frac{3 c_1^2 c_P^2}{c_\psi^2}$ and $\alpha = -\frac{c_\psi}{4 c_1^2 c_P^2}$.
    Then $T$ is bijective \ref{}. We split up $d\psi = d\psi_0 + c_\psi \mathfrak{p}$ to get 
    \begin{align*}
        &a(\sigma, \mathbf{B},\lambda;T(\sigma, \mathbf{B},\lambda))
        \\ &=\langle \sigma, \sigma - \frac{1}{c_P^2} \rho \rangle 
            - \langle \mathbf{B}, \veccurl \sigma - \frac{1}{c_P^2}\veccurl \rho \rangle
            + \langle \diver \mathbf{B}, \diver \veccurl 
        \\ &\quad + \sigma \diver \mathbf{B} + \beta \lambda \mathfrak{p}\rangle
            + \langle \lambda \mathbf{p}, \veccurl \sigma + \mathbf{B} + \beta \lambda \mathfrak{p}\rangle
            - (\alpha \langle \mathbf{B}, \mathbf{p} \rangle + \frac{\lambda}{c_\psi})
            \langle \mathbf{B} , \veccurl\psi \rangle
        \\ &= \lVert \sigma \rVert^2 - \frac{1}{c_P^2} \langle \sigma , \rho \rangle 
            + \frac{1}{c_P^2} \lVert B_\mathfrak{B} \rVert^2 + \lVert  \veccurl \sigma \rVert^2
            + \lVert \diver \mathbf{B} \rVert ^2 + \lambda ^2 \beta - \alpha c_\psi \lVert \mathbf{B}_\mathfrak{H} \rVert^2
        \\ &\quad- \alpha \langle \mathfrak{p}, \mathbf{B} \rangle \langle \mathbf{B}, \veccurl \psi_0 \rangle
            - \frac{\lambda}{c_\psi} \langle B_\mathfrak{B} , \veccurl \psi_0 \rangle
        \\ &...\geq \lVert \sigma \rVert^2 - 
            \left( \frac{1}{2} \lVert \sigma \rVert^2 
            + \frac{\lVert B_\mathfrak{B} \rVert^2}{2 c_P^2}  \right)
            + \frac{1}{c_P^2} \lVert B_\mathfrak{B} \rVert^2
            + \lVert  \veccurl \sigma \rVert^2 + \lVert \diver \mathbf{B} \rVert ^2
        \\ &\quad+ \lambda ^2 \beta - \alpha c_\psi \lVert \mathbf{B}_\mathfrak{H} \rVert^2
            - \left( \frac{\epsilon_1 \alpha^2 \lVert \mathbf{B}_\mathfrak{H} \rVert^2}{2} 
            + \frac{\lVert \mathbf{B}_\mathfrak{B} \rVert^2 \lVert  \veccurl \psi_0 \rVert^2}{2 \epsilon_1} \right)
            - \left( \frac{\lambda^2}{2 \epsilon_2 c_\psi^2} 
            + \frac{\epsilon_2 \lVert \mathbf{B}_\mathfrak{B} \rVert^2 \lVert  \veccurl \psi_0 \rVert^2}{2} \right)
    \end{align*}
    Choose $\epsilon_1 = 4 c_1^2 c_P^2$ to get 
    \begin{align*}
        &\frac{1}{2} \lVert \sigma \rVert^2 + \frac{1}{2 c_P^2} \lVert B_\mathfrak{B} \rVert^2
        + \lVert  \veccurl \sigma \rVert^2 + \lVert \diver \mathbf{B} \rVert ^2
        + \lambda ^2 \left( \beta - \frac{1}{2 \epsilon_2 c_\psi^2} \right) 
        \\ &\quad+ \lVert \mathbf{B}_\mathfrak{H} \rVert^2 
        \left( - \alpha c_\psi - \frac{4 c_1^2 c_P^2 \alpha^2}{2} \right)
        - \lVert B_\mathfrak{B} \rVert^2 \frac{\lVert  \veccurl \psi_0 \rVert^2}{8c_1^2 c_P^2}
        - \lVert B_\mathfrak{B} \rVert^2 \frac{ \epsilon_2 \lVert  \veccurl \psi_0 \rVert^2 }{2}
    \end{align*}
    Now choose $\epsilon_2 = \frac{1}{4 c_1^2 c_P^2}$ and plug in the definition of $\alpha$
    to get bound it from below with
    \begin{align*}
        &\frac{1}{2} \lVert \sigma \rVert^2 + \lVert B_\mathfrak{B} \rVert^2 
        \left( \frac{1}{2 c_P^2} - \frac{1}{8 c_P^2} 
        - \frac{\lVert  \veccurl \psi_0 \rVert^2}{8 c_1^2 c_P^2} \right)
        + \lVert  \veccurl \sigma \rVert^2 + \lVert \diver \mathbf{B} \rVert ^2
        + \lambda ^2 \left( \beta - \frac{4 c_1^2 c_P^2}{2 c_\psi^2} \right)
        \\ &\quad+ \lVert \mathbf{B}_\mathfrak{H} \rVert^2  \left( \frac{c_\psi^2}{4 c_1^2 c_P^2 }
        - \frac{ c_1^2 c_P^2 c_\psi^2}{8 c_1^4 c_P^4} \right)
    \end{align*}
    and finally by using .... and $\beta = \frac{3 c_1^2 c_P^2}{c_\psi^2}$
    \begin{align*}
        \frac{1}{2} \lVert \sigma \rVert^2 + \frac{1}{4 c_P^2}\lVert B_\mathfrak{B} \rVert^2 
        + \lVert  \veccurl \sigma \rVert^2
        + \frac{1}{2 c_P^2 B_{\mathfrak{B}^*}} + \frac{c_\psi}{8 c_1^2 c_P^2} 
        + \frac{1}{2} \lVert \diver \mathbf{B} \rVert ^2
        + \frac{c_1^2 c_P^2}{c_\psi^2}\lambda^2
        + \frac{c_\psi^2}{8 c_1^2 c_P^2} \lVert \mathbf{B}_\mathfrak{H} \rVert^2 
    \end{align*}
\end{proof}

\begin{theorem}[Stability]
    The system is stable. For solution $(\sigma, \mathbf{B},\mathbf{p}) \in X$
    we get 
    \begin{align*}
        \lVert \sigma \rVert _V + \lVert \mathbf{B} \rVert _V + |\lambda|
        \leq \frac{\lVert J \rVert + |C_1|}{\gamma}.
    \end{align*}
\end{theorem}
\begin{proof}
    The statement follows immediately from \ref{} and the fact that 
    \begin{align*}
        | l(\tau,\mathbf{v},\mu) |
        = | - \langle J, \tau \rangle - C_1 \mu | 
        \leq (\lVert J \rVert + C_1) \lVert \tau,\mathbf{v},\mu \rVert _X
    \end{align*}
    and thus $\lVert l \rVert _{X'} \leq \lVert J \rVert + | C_1 |$.
\end{proof}

\section{Discrete Hilbert complex}

In order to approximate the Hodge Laplacian problem we want to use finite elements.
We want to use them in a way that we can rebuild the structure of the Hilbert complex 
in our discretization. This section follows Sec. 5.2 in Arnold's book \cite{arnold}.

Let us assume the we have finite dimensional subspaces $V_h^k \subseteq V^k$. 
Then we define completely analogous to the continuous case,
\begin{align*}
    \mathfrak{Z}_h^k &\vcentcolon= \{ v \in V_h^k \mid d v = 0 \} = \ker d \cap V^k_h
    \\ \mathfrak{B}^k_h &\vcentcolon= \{ dv \mid v \in V_h^{k-1} \}.
\end{align*}
We can now also define the discrete harmonic forms. Now the situation is slightly 
different however. We will not use the continuous adjoint $d^*_k$ to define it.
Instead,
\begin{align*}
    \mathfrak{H}_h^k \vcentcolon= \{ v \in \mathfrak{Z}_h^k \mid v \perp \mathfrak{B}^k_h \}
        = \mathfrak{Z}_h^k \cap \mathfrak{B}_h^{k,\perp}.
\end{align*}
Notice that we have $\mathfrak{Z}_h^k \subseteq \mathfrak{Z}^k$ and 
$\mathfrak{B}_h^k \subseteq \mathfrak{b}^k$, but due to 
$\mathfrak{B}_h^{k,\perp} \supseteq \mathfrak{B}^{k,\perp}$ we have in general
\begin{align*}
    \mathfrak{H}^k = \mathfrak{Z}_h^k \cap \mathfrak{B}_h^{k,\perp} 
    \not\subseteq    \mathfrak{Z}^k \cap \mathfrak{B}^{k,\perp} = \mathfrak{H}^k.
\end{align*}

This is now already enough to define apply the mixed formulation to the discrete setting: 
For a given $f \in W^k$, find $\sigma_h \in V_h^{k-1}$, $u_h \in V_h^k$ and 
$p_h \in \mathfrak{H}^k$ s.t.

\begin{align}
    \langle \sigma_h, \tau_h \rangle - \langle u_h, d\tau_h \rangle &= 0 \quad \tau_h \in V_h^{k-1},
    \\ \langle d\sigma_h, v_h \rangle + \langle du_h, dv_h \rangle + \langle p_h, v_h \rangle 
        &= \langle f, v_h \rangle \quad v_h \in V_h^k,
    \\ \langle u_h, q_h \rangle = 0, \quad \forall q_h \in \mathfrak{H}^k_h \label{eq:third_eq_discrete_mixed}.
\end{align}
When $\mathfrak{H}_h^k \not\subseteq \mathfrak{H}^k_h$ this is a nonconforming
method. The harmonic constraint (\ref{eq:third_eq_discrete_mixed}) can 
be replaced with a different one.

There are three crucial properties that are necessary for stability and convergence 
of the method. The first one is the common and reasonable assumption that 
-- as usual in finite element theory -- we want that the discrete spaces $V_h^k$
approximate the continuous ones $V^j$. This can be generally summarized that 
\begin{align*}
    \lim_{h \rightarrow 0} \inf_{v_h \in V_h^j} \lVert w - v_h \rVert = 0, \quad \forall w \in V^j.
\end{align*}
This is usually satisfied if we use established finite elements for a given space 
e.g. if we take Lagragian FE if $V = H^1$ or Raviart-Thomas if $V=H(\diver)$ \cite{}.

The next property is more restrictive. We require that $dV_h^{k-1} \subseteq V_h^k$ 
and $dV_h^j \subseteq V_h^{j+1}$. This shows that the we cannot simply use arbitrary 
discrete subspaces independent from one another. This property has a very nice
consequence. 
It shows that 
\begin{align*}
    V_h^{k-1} \xrightarrow{d^{k-1}} V_h^k \xrightarrow{d^k} V_h^{k+1}
\end{align*}
is itself a Hilbert complex and we can apply the general theory from 
Sec. \ref{sec:hilbert_complexes} directly to it. Let us do that.

Denote the restriction of $d^j$ to $V_h^j$ as $d_h^j$. Then as a linear map 
between finite spaces the adjoint -- denoted as $d_{j,h}^*: V_h^j \rightarrow V_h^{j-1}$ -- 
is everywhere defined. It is important to notice that in contrast to $d_h$ 
the adjoint $d^*_jh$ is not the restriction of the adjoint the continuous adjoint $d^*_j$.
In general, $V_h \not\subseteq V^*$ and so the continuous adjoint might not be 
well-defined for a given $v_h \in V_h$. 

So we obtain the Hilbert complex
\begin{align*}
    V_h^{k-1} \xrightarrow{d^{k-1}} V_h^{k} \xrightarrow{d^{k}} V_h^{k+1}
\end{align*}
and its dual complex
\begin{align*}
    V_h^{k-1} \xleftarrow{d^*_k} V_h^{k} \xleftarrow{d^*_{k+1}} V_h^{k+1}
\end{align*}
From the general Hilbert complex theory (Thm.\,\ref{thm:hodge_decomposition})
we thus obtain the \textit{discrete Hodge decomposition}
\begin{align*}
    V_h^j = \mathfrak{B}^j_h \stackrel{\perp}{\oplus} \mathfrak{H}^j_h \stackrel{\perp}{\oplus}
        \mathfrak{B}^*_{jh}.
\end{align*}
So we achieved our goal of getting a structure like in the continuous case 
for our discrete approximation. Especially the question how well the discrete harmonic 
forms approximate the contiinous one will be looked at more closely.


The third crucial assumption is the existence of \textit{bounded cochain projections} $\pi_h$. 
This is a projection that is a cochain map in the sense of cochain complexes \ref{} i.e. 
the following diagram commutes:
% \begin{tikzcd}
%     A \arrow[r, "\phi"] 
%     & B \arrow[d, "\psi" red] 
% \end{tikzcd}    
$\pi_h$ are either bounded in the $V$ or in the $W$-norm where  
$W$-boundedness implies $V$ boundedness. 
The cochain projection will play an important 
role in the stablity of the discrete system.

Let us now answer the question about the difference between discrete and continous 
harmonic forms. In order to do that we need some way to measure the "difference" 
between two subspaces.

\begin{definition}[Gap between subspaces]
    For a Banach space $W$ with subspaces $Z_1$ and $Z_2$. 
    Let $S_1$ and $S_2$ be the unit spheres in $Z_1$ and $Z_2$ respectively i.e.
    $S_1 = \{ z\in Z_1 \mid \lVert z \rVert _W = 1 \}$.
    Then we define 
    the gap between these subspaces as 
    \begin{align*}
        \gap(Z_1, Z_2) = \max\{ \sup_{z_1 \in S_1} \text{dist}{z_1, Z_2}, \sup_{z_2 \in S_2} \text{dist}{z_2, Z_1} \}
    \end{align*}
\end{definition}
This definition is from \cite[p.198]{kato perturbation theory} and defines a metric on the set of closed subspaces
of $W$ (see \ref[Remark p.198]{})
If $W$ is a Hilbert space -- as it is throughout this section -- and $Z_1$ and $Z_2$ are closed then
the $\gap(Z_1, Z_2) = \lVert P_{Z_1} - P_{Z_2} \rVert$ i.e. the difference in operator norm of the 
orthogonal projections onto $Z_1$ and $Z_2$. This gives us a measure of distance between 
spaces which we can now apply to the question of the difference of the difference between 
discrete and continous harmonic forms.

\begin{proposition}[Gap between harmonic forms]
    Assume that the discrete complex \ref{} admits a $V$-bounded cochain projection
    $\pi_h$. Then
    \begin{align*}
        \lVert (I - P_{\mathfrak{H}^k_h}) q \rVert _V \leq \lVert (I - \pi_h^k) q \rVert _V, 
            \forall q \in \mathfrak{H}^k 
        \\ \lVert (I - P_{\mathfrak{H}^k}) q_h \rVert _V 
        \leq \lVert (I - \pi_h^k)P_{\mathfrak{H}^k} q \rVert _V, \forall q \in \mathfrak{H}^k, 
                \forall q_h \in \mathfrak{H}^k_h 
    \end{align*}
    and then 
    \begin{align*}
        \gap (\mathfrak{H}, \mathfrak{H}_h) 
        \leq \sup_{q \in \mathfrak{H}, \lVert q \rVert = 1} \lVert (I - \pi_h^k) q \rVert_V
    \end{align*}
\end{proposition}
\begin{proof}
    See \cite[Thm.\,5.2]{arnold}. 
\end{proof}
{\color{red} Do not forget the continuous poincare inequality}
\begin{proposition}[Discrete Poincare inequality]
    Assume that we have a $V$-bounded cochain projection $\pi_h$ for 
    the discrete Hilbert complex \ref{}. Then 
    \begin{align*}
        \lVert v \rVert _V \leq c_P \lVert \pi_h \rVert _V \lVert dv \rVert, 
            \quad \forall v \in \mathfrak{Z}_h^{k\perp}\cap V_h
    \end{align*}
    with $c_P$ being the Poincare constant from \ref{}.
\end{proposition}
\begin{proof}
    This indeed is a direct consequence of the existence of bounded cochain projections.
    Take $v_h \in \mathfrak{Z}_h^{k\perp}\cap V_h$ arbitrary. 
    Since $d (\mathfrak{Z}^{k,\perp} \cap V^k) = \mathfrak{B} \supseteq \mathfrak{B}_h$ we find 
    $z\in \mathfrak{Z}^{k\perp}\cap V_h$ s.t. $dz = dv$. We can apply now the continuous 
    Poincare inequality \ref{} to get $\lVert z \rVert _V \leq c_P \lVert dz \rVert _V = c_P \lVert dv_h \rVert _V$.
    Now we can combine the different assumptions about the discrete Hilbert complex teo get 
    $v_h - \pi_h z \in V_h^k$. Now we can use the fact that $\pi_h$ is a cochain map 
    and the fact that $\pi_h$ is a projection:
    \begin{align*}
        d\pi^k_h z = \pi^{k+1}_h dz = \pi^{k+1}_h dv_h = dv_h
    \end{align*}
    For the last equality we used also the fact that we have a discrete complex i.e. $d^k V^k_h \subseteq V^{k+1}_h$.
    That shows that $d(v_h - \pi_h z) = 0$ i.e. $(v_h - \pi_h z) \in \mathfrak{Z}_h^k$.
    Because $v_h \in \mathfrak{Z}_h^{k,\perp}$ by assumption we have 
    \begin{align*}
        0 = \langle v, v_h - \pi_h z \rangle = \langle v, v_h - \pi_h z \rangle + \langle dv, d(v_h - \pi_h z) \rangle
            = \langle v, v_h - \pi_h z \rangle _V
    \end{align*}
    so $v_h - \pi_h z$ is $V$ orthogonal to $v_h$. So 
    \begin{align*}
        \lVert v_h \rVert _V^2 = \langle v_h, \pi_h^k z \rangle _V + \langle v_h, v_h - \pi_h^k z\rangle _V 
        = \langle v_h, \pi_h^k z \rangle _V \leq \lVert \pi_h \rVert _V \lVert dv \rVert
        \stackrel{Poincare ineq.}{\leq} c_P \lVert \pi_h \rVert _V \lVert dv \rVert _V
    \end{align*}
\end{proof}

So we get the inf sup condition with $c_{P,h} = c_P \lVert \pi_h \rVert _V$ instead of $c_P$ 
and obtain well-posedness.

\section{Magnetostatic problem in 2D}

We are interested in solving the 2D version of the magnetostatic problem. 
Find $\mathbf{B} \in H(\curl) \cap H_0(\diver)$ s.t.
\begin{align*}
    \diver \mathbf{B} &= 0
    \\ \curl \mathbf{B} &= J.
\end{align*}
This problem is generally not-well posed since we need to add a harmonic constraint. 
One option is to take the orthogonality constraint again. But now we want to use the 
analogous problem that we dealt with in the first part of the thesis and add the 
constraint 
\end{document}